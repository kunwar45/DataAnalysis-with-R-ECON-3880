---
title: "Final Exam - Kunwar Nir 101257428"
date: '`r Sys.Date()`'
output: 
  html_notebook: 
    toc: yes
    toc_float: yes
    df_print: paged
editor_options: 
  markdown: 
    wrap: 72
---

# Q1

```{r echo=TRUE, message=FALSE, warning=FALSE, paged.print=TRUE}

install.packages("ggplot2")
install.packages("dplyr")
library(ggplot2)
library(dplyr)
```

```{r echo=TRUE, message=FALSE, warning=FALSE, paged.print=TRUE}
data("txhousing")
df <- txhousing

variable_names <- names(df)
print(variable_names)
```

```{r echo=TRUE, message=FALSE, warning=FALSE, paged.print=TRUE}
df$New_Var <- df$sales * df$median

num_cities <- length(unique(df$city))
print(num_cities)
```
There are 46 unique cities
```{r echo=TRUE, message=FALSE, warning=FALSE, paged.print=TRUE}
missing_sales <- sum(is.na(df$sales))
print(missing_sales)
```
There are 568 missing sales
```{r echo=TRUE, message=FALSE, warning=FALSE, paged.print=TRUE}
df_2010 <- subset(df, year == 2010)
avg_sales_2010 <- aggregate(sales ~ city, data = df_2010, mean)
names(avg_sales_2010)[2] <- "average_sales"
print(avg_sales_2010)
```
  

# Q2

```{r echo=TRUE, message=FALSE, warning=FALSE, paged.print=TRUE}
# Sum of sales per year
sales_per_year <- aggregate(sales ~ year, data = df, sum)

# Create a line graph
ggplot(sales_per_year, aes(x = year, y = sales)) +
  geom_line(color = "blue") +
  ggtitle("Total number of sales in different years") + 
  xlab("Years") + 
  ylab("Total Number of Sales") +
  theme_minimal()
```

## Q3

 $$
y = \beta_0 +\beta_1 * x1 +\beta_2 * x2 +\beta_3 * x3 + u
$$

```{r linear reg}
victoria_data <- df[df$city == "Victoria", ]

lin.model <- lm(log(sales) ~ listings + year + median, data = victoria_data)
summary(lin.model)
```
Median is the most significant, Year and intercept are a little significant. listing is not significant. 


## Q4

One problem with the code is that it is using a single equals, it needs to use a double equals sign for comparison. The pipe operator used is new and you may not have a new enough version of R to use it, the other one is safer. 

## Q5

```{r echo=TRUE, message=FALSE, warning=FALSE, paged.print=TRUE}
install.packages("maps", dependencies = TRUE)
install.packages("plotly")

library(plotly)
```  
aplease
```{r echo=TRUE, message=FALSE, warning=FALSE, paged.print=TRUE}
library(maps)
library(ggplot2)
library(dplyr)

data("canada.cities")

canada_cities_filtered <- canada.cities %>% 
  filter(country.etc != "Canada")

first_graph <- ggplot(canada_cities_filtered, aes(x = long, y = lat, color = country.etc)) +
  geom_point() +
  labs(title = "Cities in North America (Excluding Canada)",
       x = "Longitude",
       y = "Latitude",
       color = "Country") +
  theme_minimal()

# Convert ggplot to an interactive plotly plot
interactive_plot <- ggplotly(first_graph)

# Print the interactive plot
print(interactive_plot)
```   


## Q6

```{r echo=TRUE, message=FALSE, warning=FALSE, paged.print=TRUE}
install.packages("titanic")
library(titanic)

data("titanic_train")
titanic_train$Pclass <- as.numeric(titanic_train$Pclass)
titanic_train$Sex <- ifelse(titanic_train$Sex == "male", 1, 0)
titanic_train$Survived <- as.numeric(titanic_train$Survived)
titanic_train$Parch <- as.numeric(titanic_train$Parch)

# Fit the logistic regression model
model <- glm(Survived ~ Pclass + Sex + Age + Parch, data = titanic_train, family = binomial)

# Display the summary of the model
summary(model)
```


Estimated Coefficients:
(Intercept): 5.200300
Pclass: -1.287049
Sexmale: -2.585173
Age: -0.038228
Parch: -0.147168


Pclass, sex, age are significant. Parch is not significant since its P value is 0.203. 


## Q7
```{r echo=TRUE, message=FALSE, warning=FALSE, paged.print=TRUE}
library(tidyr)

data("economics_long", package = "ggplot2")


economics_long <- economics_long %>% 
  select(-value01)

econW <- economics_long %>%
  pivot_wider(names_from = date, values_from = value)

print(dim(econW))
```

There are 5 rows and 575 columns


